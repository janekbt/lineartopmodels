---
title: "Storytelling"
author: "Janek Teders"
date: "December 14, 2018"
output: pdf_document
---

```{r, setup}
library(tidyverse)
library(lubridate)

dat <- read_csv("kc_house_data.csv")

clean_dat <- dat %>%
  mutate_at(
    vars(starts_with("sqft")),
    function(x) x * 0.092903
  ) %>%
  rename_at(
    vars(starts_with("sqft")),
    function(x) str_replace(x, "sqft", "sqm")
  ) %>%
  mutate(
    week_of_year = week(date),
    month_of_year = month(date),
    renovated = factor(ifelse(yr_renovated > 0, "yes", "no"))
  ) %>%
  select(-starts_with("sqm"), starts_with("sqm"))
```

# Chapter 1: Variable selection

- remove variables based on correlation


```{r}
(corrs <- clean_dat %>%
  select(-renovated, -date, -id) %>%
  group_by(zipcode) %>%
  mutate(mean_price_zip = mean(price)) %>%
  ungroup %>%
  cor(.) %>%
  .[,1] %>%
  abs(.) %>%
  sort(.) %>%
  as.matrix(., nrow(length(.))))

good_corr <- corrs %>%
  rownames(.) %>%
  .[10:length(.)]
```

- Did a cut after yr_renovated, correlation jumps from 0.12 to 0.25 at this point.
- checking if we keep sqm_living or sqm_above and sqm_basement, because they consist of each other.

```{r}
lmo_1 <- clean_dat %>%
  select(one_of(good_corr)) %>%
  lm(data = ., log10(price) ~.)

lmo_2 <- clean_dat %>%
  select(one_of(good_corr), -sqm_living) %>%
  lm(data = ., log10(price) ~.)

lmo_3 <- clean_dat %>%
  select(one_of(good_corr), -sqm_above, -sqm_basement) %>%
  lm(data = ., log10(price) ~.)

anova(lmo_1, lmo_2, lmo_3)
```

- cool thing: na's in sqm_living because it is a linear combination of sqm_above and sqm_basement
- lmo_3 (with sqm_living) performs better than lmo_2 (with sqm_above and sqm_basement)

```{r}
vars_1 <- good_corr[! good_corr %in% c("sqm_above", "sqm_basement")]
```














